generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Todos {
  id          Int       @id @default(autoincrement())
  title       String    @db.VarChar(255)
  description String?
  isCompleted Boolean?  @default(false) @map("is_completed")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("todos")
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  role         String
  tournaments  Tournament[]
  participants Participant[]

  @@map("user")
}

model Tournament {
  id           Int               @id @default(autoincrement())
  name         String
  date         DateTime
  location     String?
  organizerId  Int               @map("organizer_id")
  organizer    User              @relation(fields: [organizerId], references: [id])
  events       TournamentEvent[]
  participants Participant[]

  @@map("tournament")
}

model Event {
  id          Int               @id @default(autoincrement())
  name        String
  tournaments TournamentEvent[] @relation("EventToTournamentEvent")
  allowedDivisions EventAllowedDivision[] 
  @@map("event")
}

model Division {
  id             Int             @id @default(autoincrement())
  name           String
  minAge         Int?            @map("min_age")
  maxAge         Int?            @map("max_age")
  beltRankId     Int?            @map("belt_rank_id")
  beltRank       BeltRank?       @relation(fields: [beltRankId], references: [id])
  tournamentEventDivisions TournamentEventDivision[]
  allowedEvents EventAllowedDivision[]

  @@map("division")
}

model TournamentEventDivision {
  id                 Int              @id @default(autoincrement())
  tournamentEventId  Int              @map("tournament_event_id")
  tournamentEvent    TournamentEvent  @relation(fields: [tournamentEventId], references: [id])
  divisionId         Int              @map("division_id")
  division           Division         @relation(fields: [divisionId], references: [id])
  genderId           Int              @map("gender_id")
  eventGender        EventGender      @relation(fields: [genderId], references: [id])
  displayName        String?          @map("display_name")
  registrations      Registration[]

  @@map("tournament_event_division")
}

model Participant {
  id            Int            @id @default(autoincrement())
  firstName     String         @map("first_name")
  lastName      String         @map("last_name")
  age           Int
  genderId Int @map("gender_id")
  gender   EventGender @relation(fields: [genderId], references: [id])
  tournamentId  Int            @map("tournament_id")
  tournament    Tournament     @relation(fields: [tournamentId], references: [id])
  userId        Int            @map("user_id")
  user          User           @relation(fields: [userId], references: [id])
  beltRankId Int    @map("belt_rank_id")
  rank          BeltRank @relation(fields: [beltRankId], references:[id])
  registrations Registration[]
  notes         String?
  paid          Boolean        @default (false)
  


  @@map("participant")
}

model Registration {
  id              Int           @id @default(autoincrement())
  participantId   Int           @map("participant_id")
  participant     Participant   @relation(fields: [participantId], references: [id])
  eventDivisionId Int           @map("event_division_id")
  tournamentEventDivision   TournamentEventDivision @relation(fields: [eventDivisionId], references: [id])

  @@map("registration")
}

model TournamentEvent {
  id           Int        @id @default(autoincrement())
  tournamentId Int        @map("tournament_id")
  tournament   Tournament @relation(fields: [tournamentId], references: [id])
  eventId      Int        @map("event_id")
  event        Event      @relation("EventToTournamentEvent", fields: [eventId], references: [id])
  bracketType  String?    @map("bracket_type")
  tournamentEventDivisions TournamentEventDivision[]
  @@map("tournament_event")
}

model BeltRank {
  id          Int        @id @default(autoincrement())
  rank        String
  beltColor   String     @map("belt_color")
  disiplineId Int        @map("disipline_id")
  disipline   Disipline  @relation(fields: [disiplineId], references: [id])
  sortOrder   Int           @map("sort_order") @default(0)
  divisions   Division[]
  participants Participant[]

  @@map("belt_rank")
}

model Disipline {
  id          Int        @id @default(autoincrement())
  description String
  beltRanks   BeltRank[]

  @@map("disipline")
}

model EventGender {
  id             Int             @id @default(autoincrement())
  description    String
  tournamentEventDivisions TournamentEventDivision[]
  participants   Participant[]  

  @@map("event_gender")
}

model EventAllowedDivision {
  id         Int       @id @default(autoincrement())
  eventId    Int       @map("event_id")
  divisionId Int       @map("division_id")
  event      Event     @relation(fields: [eventId], references: [id])
  division   Division  @relation(fields: [divisionId], references: [id])

  @@unique([eventId, divisionId])
  @@map("event_allowed_division")
}